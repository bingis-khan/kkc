#!./zig-out/bin/kkc
use Alloc
use List
use Slice

al = Alloc.get-c-allocator()
s = 1 to (10)
	map(Just)
	to-list(al)
	List.to-slice()

inst ListLike Slice
	deconstruct (self, lp, lc, spread, rp, rc)
		ls = Slice { ptr: lp, count: lc }
		rs = Slice { ptr: rp, count: rc }

		if ls.count > 0
			if ls.count > self.count
				return False

			self
				subslice(0, ls.count)
				Slice.copy-to (ls)

		if rs.count > 0
			if rs.count + ls.count > self.count
				return False

			self
				subslice(self.count - rs.count, self.count)
				Slice.copy-to (rs)

		case spread
			NoSpread
				return ls.count + rs.count == self.count

			UnassignedSpread
				return True

			AssignedSpread(xptr)
				xptr <&= self
					subslice(ls.count, self.count - rs.count)
				return True
case s
	[x, None, z, ...dupa, _, _]
		# println(miau)
		println(x)
		# println(y)
		println(z)
		println(dupa)

	xs
		println('not matched: \(xs)')

al Alloc.free(s)
